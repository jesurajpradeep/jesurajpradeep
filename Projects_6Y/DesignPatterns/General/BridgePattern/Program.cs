using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace BridgePattern
{

    /*
   Purpose??
    1. Abstractions and implementations should be modified independently.
    2. Changes in the implementation of an abstraction should have no impact on clients.
    3. The Bridge pattern is used when a new version of a software or system is brought out, 
       but the older version of the software still running for its existing client. There is no 
       need to change the client code, but the client need to choose which version he wants to use.
     
     Note : --> Bridge pattern has nearly the same structure as the Adapter Pattern. 
     But it is used when designing new systems instead of the Adapter pattern which is used with 
     already existing systems. 
    */

    public interface IMessageSender
    {
        void SendMessage(string subject, string body);
    }

    /// <summary>
    /// The 'ConcreteImplementor' class
    /// </summary>
    public class EmailSender : IMessageSender
    {
        public void SendMessage(string subject, string body)
        {
            Console.WriteLine("Email\n{0}\n{1}\n", subject, body);
        }
    }

    /// <summary>
    /// The 'ConcreteImplementor' class
    /// </summary>
    public class MSMQSender : IMessageSender
    {
        public void SendMessage(string subject, string body)
        {
            Console.WriteLine("MSMQ\n{0}\n{1}\n", subject, body);
        }
    }

    /// <summary>
    /// The 'ConcreteImplementor' class
    /// </summary>
    public class WebServiceSender : IMessageSender
    {
        public void SendMessage(string subject, string body)
        {
            Console.WriteLine("Web Service\n{0}\n{1}\n", subject, body);
        }
    }


    /// <summary>
    /// The 'Abstraction' class
    /// </summary>
    public abstract class Message
    {
        public IMessageSender MessageSender { get; set; }
        public string Subject { get; set; }
        public string Body { get; set; }
        public abstract void Send();
    }

    /// <summary>
    /// The 'RefinedAbstraction' class
    /// </summary>
    public class SystemMessage : Message
    {
        public override void Send()
        {
            MessageSender.SendMessage(Subject, Body);
        }
    }

    /// <summary>
    /// The 'RefinedAbstraction' class
    /// </summary>
    public class UserMessage : Message
    {
        public string UserComments { get; set; }

        public override void Send()
        {
            string fullBody = string.Format("{0}\nUser Comments: {1}", Body, UserComments);
            MessageSender.SendMessage(Subject, fullBody);
        }
    }

    class Program
    {
        static void Main(string[] args)
        {
            IMessageSender email = new EmailSender();
            IMessageSender queue = new MSMQSender();
            IMessageSender web = new WebServiceSender();

            Message message = new SystemMessage();
            message.Subject = "Test Message";
            message.Body = "Hi, This is a Test Message";

            message.MessageSender = email;
            message.Send();

            message.MessageSender = queue;
            message.Send();

            message.MessageSender = web;
            message.Send();


        }
    }
}
